# TDH模型测试脚本使用说明 (纯手动版)

本目录包含TDH(总扬程)模型性能测试脚本，专为完全手动数据控制设计。

## 文件说明

### 🌟 `test_tdh_pure_manual.py` - **推荐使用**
最简洁的纯手动测试脚本：
- 完全手动控制数据
- 无需任何文件加载
- 代码简洁易懂
- 包含完整示例

### 📊 `test_tdh_model.py` - 完整版
功能全面但简化的测试脚本：
- 支持SVRInput实例和数值数组
- 详细的性能分析和可视化
- 完整的结果导出功能

### 🔧 `test_tdh_simple.py` - 简化版
轻量级测试脚本：
- 支持多种输入格式
- 基本性能指标和可视化

## 🚀 快速开始 (推荐方式)

### 1. 使用纯手动脚本

```python
# 只需修改两个地方：

# 1. 修改模型文件夹名称
MODEL_FOLDER = "TDH-20250802_203937"  # 改为您的模型文件夹

# 2. 在 create_test_data() 函数中添加您的测试数据
test_cases = [
    {
        'input': SVRInput(
            phdm=2800, freq=2750, Pr=15.5, IP=8.2, BHT=85, Qf=120,
            BSW=0.25, API=28.5, GOR=150, Pb=12.3, WHP=8.5
        ),
        'expected_tdh': 185.6
    },
    # 添加更多测试用例...
]

# 3. 运行测试
python test_tdh_pure_manual.py
```

### 2. 完整版脚本使用

```python
from models.model import SVRInput
from test_tdh_model import TDHModelTester

# 创建测试器
tester = TDHModelTester()

# 创建测试数据
test_inputs = [
    SVRInput(phdm=2800, freq=2750, Pr=15.5, IP=8.2, BHT=85, 
             Qf=120, BSW=0.25, API=28.5, GOR=150, Pb=12.3, WHP=8.5)
]
expected_values = [185.6]

# 运行测试
results = tester.run_test("TDH-20250802_203937", test_inputs, expected_values)
```

## 📊 TDH特征参数说明

| 参数 | SVRInput属性 | 含义 | 单位 | 典型范围 |
|------|-------------|------|------|----------|
| phdm | phdm | 射孔垂深 | m | 2000-4000 |
| freq | freq | 泵挂垂深 | m | 2000-4000 |
| Pr | Pr | 油藏压力 | MPa | 10-25 |
| IP | IP | 生产指数 | m³/(d·MPa) | 5-15 |
| BHT | BHT | 井底温度 | °C | 70-120 |
| Qf | Qf | 期望产量 | m³/d | 80-200 |
| BSW | BSW | 含水率 | 无量纲 | 0.1-0.6 |
| API | API | 原油密度 | °API | 20-40 |
| GOR | GOR | 油气比 | m³/m³ | 100-300 |
| Pb | Pb | 泡点压力 | MPa | 8-20 |
| WHP | WHP | 井口压力 | MPa | 5-15 |

## 📝 创建测试数据的最佳实践

### ✅ 推荐方式 - 使用SVRInput

```python
# 清晰、安全、易维护
test_input = SVRInput(
    phdm=2800,    # 射孔垂深
    freq=2750,    # 泵挂垂深  
    Pr=15.5,      # 油藏压力PR
    IP=8.2,       # 生产指数IP
    BHT=85,       # 井底温度BHT
    Qf=120,       # 期望产量QF
    BSW=0.25,     # 含水率BSW
    API=28.5,     # 原油密度API
    GOR=150,      # 油气比GOR
    Pb=12.3,      # 泡点压力Pb
    WHP=8.5       # 井口压力WHP
)
```

### ❌ 避免的方式 - 直接使用数组

```python
# 容易出错、难以维护
test_array = [2800, 2750, 15.5, 8.2, 85, 120, 0.25, 28.5, 150, 12.3, 8.5]
```

## 📈 输出结果说明

### 控制台输出
```
============================================================
TDH模型性能测试
============================================================
测试样本数: 3
加载模型: d:\projects\Qt_Oil_New\TDHsave\TDH-20250802_203937
测试数据形状: X=(3, 11), y=(3,)
开始预测...

========================================
性能指标
========================================
MAPE: 0.0234 (2.34%)
MAE:  4.52
RMSE: 5.67
R²:   0.9456

详细结果:
样本 真实值   预测值   误差     相对误差%
---------------------------------------------
1    185.60  189.23  3.63    1.96
2    201.30  198.45  2.85    1.42
3    175.20  172.48  2.72    1.55

========================================
性能评价
========================================
🎉 性能等级: 优秀
   评价: 模型预测非常准确
   MAPE阈值: < 5%(优秀), < 10%(良好), < 15%(一般), ≥ 15%(需改进)
```

### 可视化图表
- **预测 vs 真实值散点图** - 评估整体准确性
- **误差分布柱状图** - 分析各样本的预测误差

## 🎯 性能评价标准

| MAPE范围 | 性能等级 | 图标 | 说明 |
|----------|----------|------|------|
| < 5% | 优秀 | 🎉 | 模型预测非常准确 |
| 5-10% | 良好 | 👍 | 模型预测较为准确 |
| 10-15% | 一般 | 👌 | 模型预测基本可用 |
| ≥ 15% | 需改进 | ⚠️ | 建议重新训练模型 |

## 🔧 使用步骤

### Step 1: 准备模型
确保您的模型文件夹在 `TDHsave` 目录下，格式通常为 `TDH-YYYYMMDD_HHMMSS`

### Step 2: 修改配置
```python
MODEL_FOLDER = "您的模型文件夹名称"  # 如: "TDH-20250802_203937"
```

### Step 3: 创建测试数据
在 `create_test_data()` 函数中添加您的测试用例：

```python
test_cases = [
    {
        'input': SVRInput(phdm=..., freq=..., Pr=..., ...),
        'expected_tdh': 预期的TDH值
    },
    # 更多测试用例
]
```

### Step 4: 运行测试
```bash
python test_tdh_pure_manual.py
```

## ❓ 常见问题

### Q: 如何找到模型文件夹名称？
A: 查看 `TDHsave` 目录，文件夹名称通常为 `TDH-日期_时间` 格式

### Q: SVRInput参数顺序重要吗？
A: 不重要，使用命名参数确保数据正确映射

### Q: 如何验证我的测试数据是否正确？
A: 检查参数值是否在合理范围内，参考上面的参数说明表

### Q: 可以测试单个样本吗？
A: 可以，在 `test_cases` 中只保留一个测试用例即可

### Q: 如何解读MAPE值？
A: MAPE是平均绝对百分比误差，< 10%通常表示模型性能良好

## 💡 最佳实践

1. **使用有意义的测试数据** - 选择代表性的井况参数
2. **包含边界情况** - 测试极值和边界条件
3. **多样化测试** - 覆盖不同的工况组合
4. **验证数据合理性** - 确保输入参数在实际范围内
5. **记录测试结果** - 保存测试配置和结果以便后续对比

---

**提示**: `test_tdh_pure_manual.py` 是最推荐的使用方式，代码简洁、易懂、易维护。
