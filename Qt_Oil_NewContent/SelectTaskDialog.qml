import QtQuick
import QtQuick.Controls
import QtQuick.Layouts

Item {
    id: root

    // Ê∑ªÂä†ËØ≠Ë®ÄÂ±ûÊÄß
    property bool isChinese: parent && parent.parent ? parent.parent.isChinese : true
    property int selectedTask: -1

    Dialog {
        id: dialog
        width: 700
        height: 500
        modal: true
        anchors.centerIn: parent

        // Ëá™ÂÆö‰πâÊ†áÈ¢òÊ†è
        header: Rectangle {
            height: 60
            color: "#1e3a5f"

            RowLayout {
                anchors.fill: parent
                anchors.leftMargin: 24
                anchors.rightMargin: 16

                Text {
                    text: root.isChinese ? "ÈÄâÊã©È¢ÑÊµã‰ªªÂä°" : "Select Prediction Task"
                    color: "white"
                    font.pixelSize: 18
                    font.bold: true
                }

                Item { Layout.fillWidth: true }

                RoundButton {
                    width: 32
                    height: 32

                    background: Rectangle {
                        radius: width / 2
                        color: parent.hovered ? Qt.rgba(255, 255, 255, 0.2) : "transparent"
                    }

                    contentItem: Text {
                        text: "‚úï"
                        color: "white"
                        font.pixelSize: 16
                        horizontalAlignment: Text.AlignHCenter
                        verticalAlignment: Text.AlignVCenter
                    }

                    onClicked: dialog.close()
                }
            }
        }

        // ÂÜÖÂÆπÂå∫Âüü
        contentItem: Rectangle {
            color: "#f5f7fa"

            ScrollView {
                anchors.fill: parent
                anchors.margins: 24
                contentWidth: parent.width - 48

                ColumnLayout {
                    width: parent.width
                    spacing: 20

                    // ‰ªªÂä°ËØ¥Êòé
                    Text {
                        Layout.fillWidth: true
                        text: root.isChinese ?
                            "ËØ∑ÈÄâÊã©Ë¶ÅÊâßË°åÁöÑÊú∫Âô®Â≠¶‰π†‰ªªÂä°Á±ªÂûãÔºåÁ≥ªÁªüÂ∞ÜÊ†πÊçÆÊÇ®ÁöÑÈÄâÊã©ÂáÜÂ§áÁõ∏Â∫îÁöÑËÆ≠ÁªÉÊï∞ÊçÆÂíåÊ®°Âûã„ÄÇ" :
                            "Please select the type of machine learning task to execute. The system will prepare corresponding training data and models based on your selection."
                        wrapMode: Text.WordWrap
                        color: "#666"
                        font.pixelSize: 14
                        lineHeight: 1.4
                    }

                    // ‰ªªÂä°ÈÄâÈ°π
                    ColumnLayout {
                        Layout.fillWidth: true
                        spacing: 16

                        // ‰∫ßËÉΩÈ¢ÑÊµã
                        TaskOptionCard {
                            Layout.fillWidth: true
                            taskId: 0
                            title: root.isChinese ? "‰∫ßËÉΩÈ¢ÑÊµãÊ®°Âûã" : "Production Forecast Model"
                            description: root.isChinese ?
                                "Âü∫‰∫éÂéÜÂè≤Áîü‰∫ßÊï∞ÊçÆÂíåÊ≤π‰∫ïÂèÇÊï∞ÔºåÈ¢ÑÊµãÊú™Êù•‰∫ßËÉΩÂèòÂåñË∂ãÂäøÔºåÂ∏ÆÂä©Âà∂ÂÆöÁîü‰∫ßËÆ°Âàí„ÄÇ" :
                                "Predict future production trends based on historical data and well parameters to help with production planning."
                            icon: "üìà"
                            isSelected: root.selectedTask === 0
                            onClicked: root.selectedTask = 0
                        }

                        // ËÆæÂ§áÊïÖÈöúÈ¢ÑÊµã
                        TaskOptionCard {
                            Layout.fillWidth: true
                            taskId: 1
                            title: root.isChinese ? "ËÆæÂ§áÊïÖÈöúÈ¢ÑÊµã" : "Equipment Failure Prediction"
                            description: root.isChinese ?
                                "ÂàÜÊûêËÆæÂ§áËøêË°åÊï∞ÊçÆÔºåÈ¢ÑÊµãÂèØËÉΩÂèëÁîüÊïÖÈöúÁöÑÊó∂Èó¥ÂíåÁ±ªÂûãÔºåÂÆûÁé∞È¢ÑÈò≤ÊÄßÁª¥Êä§„ÄÇ" :
                                "Analyze equipment operation data to predict failure time and type for preventive maintenance."
                            icon: "üîß"
                            isSelected: root.selectedTask === 1
                            onClicked: root.selectedTask = 1
                        }

                        // ÈÄâÂûã‰ºòÂåñ
                        TaskOptionCard {
                            Layout.fillWidth: true
                            taskId: 2
                            title: root.isChinese ? "ÈÄâÂûã‰ºòÂåñÊ®°Âûã" : "Selection Optimization Model"
                            description: root.isChinese ?
                                "‰ºòÂåñËÆæÂ§áÈÄâÂûãÊé®ËçêÁÆóÊ≥ïÔºåÊèêÈ´òÊé®ËçêÂáÜÁ°ÆÁéáÂíåÈÄÇÈÖçÊÄß„ÄÇ" :
                                "Optimize equipment selection recommendation algorithm to improve accuracy and adaptability."
                            icon: "üéØ"
                            isSelected: root.selectedTask === 2
                            onClicked: root.selectedTask = 2
                        }

                        // ËÉΩËÄó‰ºòÂåñ
                        TaskOptionCard {
                            Layout.fillWidth: true
                            taskId: 3
                            title: root.isChinese ? "ËÉΩËÄó‰ºòÂåñÂàÜÊûê" : "Energy Optimization Analysis"
                            description: root.isChinese ?
                                "ÂàÜÊûêËÆæÂ§áËÉΩËÄóÊï∞ÊçÆÔºåËØÜÂà´ËäÇËÉΩÊΩúÂäõÔºåÊèê‰æõ‰ºòÂåñÂª∫ËÆÆ„ÄÇ" :
                                "Analyze equipment energy consumption data, identify energy-saving potential, and provide optimization suggestions."
                            icon: "‚ö°"
                            isSelected: root.selectedTask === 3
                            onClicked: root.selectedTask = 3
                        }
                    }

                    Item { Layout.fillHeight: true }
                }
            }
        }

        // Â∫ïÈÉ®ÊåâÈíÆ
        footer: Rectangle {
            height: 60
            color: "white"

            Rectangle {
                anchors.top: parent.top
                width: parent.width
                height: 1
                color: "#e0e0e0"
            }

            RowLayout {
                anchors.fill: parent
                anchors.margins: 16
                spacing: 12

                Item { Layout.fillWidth: true }

                Button {
                    text: root.isChinese ? "ÂèñÊ∂à" : "Cancel"
                    flat: true

                    contentItem: Text {
                        text: parent.text
                        color: "#666"
                        horizontalAlignment: Text.AlignHCenter
                        verticalAlignment: Text.AlignVCenter
                    }

                    background: Rectangle {
                        color: parent.hovered ? "#f5f5f5" : "transparent"
                        border.color: "#ddd"
                        border.width: 1
                        radius: 6
                    }

                    onClicked: dialog.close()
                }

                Button {
                    text: root.isChinese ? "‰∏ã‰∏ÄÊ≠•" : "Next"
                    enabled: root.selectedTask >= 0

                    contentItem: Text {
                        text: parent.text
                        color: "white"
                        horizontalAlignment: Text.AlignHCenter
                        verticalAlignment: Text.AlignVCenter
                    }

                    background: Rectangle {
                        color: parent.enabled ? (parent.hovered ? "#357abd" : "#4a90e2") : "#cccccc"
                        radius: 6
                    }

                    onClicked: {
                        selectTask()
                        dialog.close()
                    }
                }
            }
        }
    }

    // ‰ªªÂä°ÈÄâÈ°πÂç°ÁâáÁªÑ‰ª∂
    component TaskOptionCard: Rectangle {
        property int taskId: 0
        property string title: ""
        property string description: ""
        property string icon: ""
        property bool isSelected: false

        signal clicked()

        height: 100
        color: "white"
        radius: 8
        border.width: isSelected ? 2 : 1
        border.color: isSelected ? "#4a90e2" : "#e0e0e0"

        Behavior on border.color {
            ColorAnimation { duration: 150 }
        }

        RowLayout {
            anchors.fill: parent
            anchors.margins: 20
            spacing: 16

            // ÂõæÊ†á
            Rectangle {
                width: 48
                height: 48
                radius: 12
                color: isSelected ? "#e8f0fe" : "#f5f7fa"

                Text {
                    anchors.centerIn: parent
                    text: icon
                    font.pixelSize: 24
                }
            }

            // ÊñáÊú¨ÂÜÖÂÆπ
            ColumnLayout {
                Layout.fillWidth: true
                spacing: 6

                Text {
                    text: title
                    font.pixelSize: 16
                    font.bold: true
                    color: "#2c3e50"
                }

                Text {
                    Layout.fillWidth: true
                    text: description
                    font.pixelSize: 13
                    color: "#666"
                    wrapMode: Text.WordWrap
                    lineHeight: 1.3
                }
            }

            // ÈÄâ‰∏≠Ê†áËÆ∞
            Rectangle {
                width: 24
                height: 24
                radius: 12
                color: "transparent"
                border.width: 2
                border.color: isSelected ? "#4a90e2" : "#ddd"

                Rectangle {
                    width: 12
                    height: 12
                    radius: 6
                    anchors.centerIn: parent
                    color: "#4a90e2"
                    visible: isSelected
                }
            }
        }

        MouseArea {
            anchors.fill: parent
            cursorShape: Qt.PointingHandCursor
            hoverEnabled: true

            onClicked: parent.clicked()

            onEntered: {
                if (!parent.isSelected) {
                    parent.color = "#fafafa"
                }
            }

            onExited: {
                parent.color = "white"
            }
        }
    }

    // ÈÄâÊã©‰ªªÂä°
    function selectTask() {
        var taskNames = [
            root.isChinese ? "‰∫ßËÉΩÈ¢ÑÊµãÊ®°Âûã" : "Production Forecast Model",
            root.isChinese ? "ËÆæÂ§áÊïÖÈöúÈ¢ÑÊµã" : "Equipment Failure Prediction",
            root.isChinese ? "ÈÄâÂûã‰ºòÂåñÊ®°Âûã" : "Selection Optimization Model",
            root.isChinese ? "ËÉΩËÄó‰ºòÂåñÂàÜÊûê" : "Energy Optimization Analysis"
        ]

        console.log(root.isChinese ? "ÈÄâÊã©ÁöÑ‰ªªÂä°:" : "Selected task:", taskNames[root.selectedTask])
        // ËøôÈáåË∞ÉÁî®ÂêéÁ´ØAPIÊàñÂØºËà™Âà∞‰∏ã‰∏ÄÊ≠•
    }

    // ÊâìÂºÄÂØπËØùÊ°Ü
    function open() {
        dialog.open()
    }

    // ÂÖ≥Èó≠ÂØπËØùÊ°Ü
    function close() {
        dialog.close()
    }
}
